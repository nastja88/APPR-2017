---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Nastja Košir"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Analizirala bom nekaj najpogostejših bolezni (AIDS, tuberkuloza, malarija, kolera, sifilis) po državah in letih (2000-2015) ter skušala ugotoviti razlog zanje (npr. podhranjenost, debelost, higijenske razmere, kvaliteta vode, onesnaženost, število plačanih prostih dni...). Moj cilj je ugotoviti, kako poskrbeti za to, da bi imeli kar najbolj zdravo populacijo.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Uvozila sem podatke o boleznih in potencialnih razlogih zanje v obliki CSV s spletnih strani organizacij The world bank in World Health Organisation ter v obliki HTML z Wikipedije.

### Začetki razpredelnic:

Tabela **bolezni** je sestavljena iz stolpcev bolezen, drzava, leto in pojavnost (meritev). 

Spremenljivka hiv v stolpcu bolezen predstavlja delež okuženih z virusom hiv  na leto med osebami, ki so stare od 15 do 49 let. Spremenljivka sifilis predstavlja delež živorojenih otrok na leto, okuženih s prirojenim sifilisom, podobno tuberkuloza delež okuženih s tuberkulozo na leto. Spremenljivki malarija in kolera označujeta število potrjenih primerov malarije oz. kolere na leto. Podatki so zbrani za leta 2000-2015.

```{r bolezni, echo=FALSE, message=FALSE}
kable(head(bolezni))
```

Tabelo **znacilnosti** sestavljajo stolpci znacilnost, drzava, leto in pojavnost (meritev). 

Spremenljivka voda v stolpcu znacilnost predstavlja delež populacije z dostopom do izboljšanega pitnega vodnega vira (zasebna in javna vodovodna napeljava, javni hidranti, zavarovani vodnjaki in izviri, zbrana deževnica). Spremenljivka denar pomeni zdravstveno potrošnjo na prebivalca (preračunano na mednarodni dolar, 2011). Spremenljivka podhranjenost (debelost) prikazuje delež otrok, mlajših od pet let, s prenizko (previsoko) telesno težo. Spremenljivka alkohol prikazuje porabo alkohola med osebami, starejšimi od 15 let, v litrih čistega alkohola.

```{r znacilnosti, echo=FALSE, message=FALSE}
kable(head(znacilnosti))
```

Tabela **tobak** je sestavljena iz stolpcev drzava, leto, spol in pojavnost (meritev), pri čemer spremenljivka pojavnost meri delež oseb starejših od 15 let, ki kadijo katerikoli tobačni izdelek.

```{r tobak0, echo=FALSE, message=FALSE}
kable(head(tobak))
```

Tabelo **tabela** gradita stolpca drzava in dopust (meritev), v katerem je shranjeno minimalno število plačanih prostih dni (vključno s prazniki) pri petdnevnem delovniku kot ga določa zakon. Velja še omeniti, da ponekod to število določijo delodajalci, in se praznik, ki pride na soboto ali nedeljo, v ZDA in UK premakne kot plačan dela prost dan na najbližji ponedeljek oz. petek. 

```{r tabela, echo=FALSE, message=FALSE}
kable(head(tabela))
```

***

# Analiza in vizualizacija podatkov

Spodnji graf prikazuje globalno porabo alkohola med osebami, starimi vsaj 15 let, izraženo v litrih čistega alkohola, od leta 2000 do 2015. Opazen je trend naraščanja, poleg tega pa tudi velik skok med letoma 2011 in 2012. Pripisujem ga gospodarski krizi leta 2012, je pa zanimivo, da ni večjega skoka v času gospodarske krize leta 2008.

```{r alkohol, echo=FALSE, message=FALSE}
alko <- filter(znacilnosti, znacilnosti$znacilnost == "alkohol") %>% group_by(leto) %>% summarise(povprecje = mean(pojavnost)) 
alko <- alko[order(alko$leto), ]
ggplot(alko) + aes(x=leto, y=povprecje) + geom_point() + theme_bw() + labs(y="globalna poraba alkohola(15+) [liter čistega alkohola]")
```

Spodnji graf prikazuje delež kadilcev med osebami, starimi vsaj 15 let, ločeno po spolu v letih 2000, 2005, 2010, 2012 in 2015. Presenetilo me je, da je delež kadilcev med moškimi (36.3%) veliko večji kot med ženskami (13.6%). (Slednja procenta sta izračunana kot povprečna deleža med letoma 2000 in 2015.)

```{r tobak, echo=FALSE, message=FALSE}
ggplot(tobak) + aes(x=leto, y=pojavnost, color=spol) + geom_jitter() + theme_bw() + labs(y="pojavnost kajenja(15+) [%]")
```

Zemljevid prikazuje število plačanih prostih dni na leto pri 5-dnevnem delovniku. Presenečena sem bila nad ugotovitvijo, da v ZDA ni plačan niti dan dopusta na leto. Poleg tega sem pričakovala, da je v Afriki to število precej manjše.

```{r dopust, echo=FALSE, message=FALSE, warning=FALSE}
svet <- uvozi.zemljevid("http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/cultural/ne_110m_admin_0_countries.zip",
                       "ne_110m_admin_0_countries") %>% pretvori.zemljevid()
ggplot() + geom_polygon(data = left_join(svet, tabela, by=c("sovereignt" = "drzava")), 
                        aes(x = long, y = lat, group = group, fill=dopust)) + theme_void() + ggtitle("Število plačnih prostih dni(5 delovnih dni/teden)") + theme(plot.title = element_text(hjust = 0.5))

```


Na naslednjem grafu je prikazano število okuženih z malarijo v letih od 2000 do 2015, dodani so tudi kvartili porazdelitve. Opazen je velik trend naraščanja.

```{r malarija, echo=FALSE, message=FALSE}
ggplot(filter(bolezni, bolezni$bolezen == "malarija" )) + aes(x=leto, y=pojavnost) + geom_boxplot() + theme_bw() + labs(y="število okuženih z malarijo")
```

***

# Napredna analiza podatkov

***

