---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Nastja Košir"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

Analizirala bom nekaj najpogostejših bolezni (AIDS, tuberkuloza, malarija, kolera, sifilis) po državah in letih (2000-2015) ter skušala ugotoviti razlog zanje (npr. podhranjenost, prekomerna teža, dostopnost pitne vode, poraba alkohola in tobačnih izdelkov, število plačanih prostih dni, zdravstvena potrošnja). Moj cilj je ugotoviti, kako poskrbeti za to, da bi imeli kar najbolj zdravo populacijo.

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Uvozila sem podatke o boleznih in potencialnih razlogih zanje v obliki CSV s spletnih strani organizacij *The world bank* in *World Health Organisation* ter v obliki HTML z *Wikipedije*.

### Začetki razpredelnic:

Tabela **bolezni** je sestavljena iz stolpcev *bolezen*, *drzava*, *leto* in *pojavnost* (meritev). 

Spremenljivka *hiv* v stolpcu *bolezen* predstavlja delež okuženih z virusom hiv  na leto med osebami, ki so stare od 15 do 49 let. Spremenljivka *sifilis* predstavlja delež živorojenih otrok na leto, okuženih s prirojenim sifilisom, podobno *tuberkuloza* delež okuženih s tuberkulozo na leto. Spremenljivki *malarija* in *kolera* označujeta število potrjenih primerov malarije oz. kolere na leto. Podatki so zbrani za leta 2000-2015.

```{r bolezni, echo=FALSE, message=FALSE}
kable(head(bolezni), align="cccc")
```

Tabelo **znacilnosti** sestavljajo stolpci *znacilnost*, *drzava*, *leto* in *pojavnost* (meritev). 

Spremenljivka *voda* v stolpcu *znacilnost* predstavlja delež populacije z dostopom do izboljšanega pitnega vodnega vira (zasebna in javna vodovodna napeljava, javni hidranti, zavarovani vodnjaki in izviri, zbrana deževnica). Spremenljivka *denar* pomeni zdravstveno potrošnjo na prebivalca (preračunano na mednarodni dolar, 2011). Spremenljivka *podhranjenost* (*debelost*) prikazuje delež otrok, mlajših od pet let, s prenizko (previsoko) telesno težo. Spremenljivka *alkohol* prikazuje porabo alkohola med osebami, starejšimi od 15 let, v litrih čistega alkohola. Podatki so zbrani za leta 2000-2015.

```{r znacilnosti, echo=FALSE, message=FALSE}
kable(head(znacilnosti), align="cccc")
```

Tabela **tobak** je sestavljena iz stolpcev *drzava*, *leto*, *spol* in *pojavnost* (meritev), pri čemer spremenljivka *pojavnost* meri delež oseb starejših od 15 let, ki kadijo katerikoli tobačni izdelek. Našla sem podatke za leta 2000, 2005, 2010, 2012 in 2015.

```{r tobak0, echo=FALSE, message=FALSE}
kable(head(tobak), align="cccc")
```

Tabelo **tabela** gradita stolpca *drzava* in *dopust* (meritev), v katerem je shranjeno minimalno število plačanih prostih dni (vključno s prazniki) pri petdnevnem delovniku kot ga določa zakon. 

Velja še omeniti, da ponekod to število določijo delodajalci, in da se praznik, ki pride na soboto ali nedeljo, v ZDA in UK premakne kot plačan dela prost dan na najbližji ponedeljek oz. petek. 

```{r tabela, echo=FALSE, message=FALSE}
kable(head(tabela), align="cccc")
```

***

# Analiza in vizualizacija podatkov

Spodnji graf prikazuje globalno porabo alkohola med osebami, starimi vsaj 15 let, izraženo v litrih čistega alkohola, od leta 2000 do 2015. Opazen je trend naraščanja, poleg tega pa tudi velik skok med letoma 2011 in 2012. Pripisujem ga gospodarski krizi leta 2012, je pa zanimivo, da ni večjega skoka v času gospodarske krize leta 2008.

Dodana je tudi kvadratna aproksimacija gibanja porabe alkohola.

```{r alkohol, fig.align='center', echo=FALSE, message=FALSE}
g_alk1
```

Spodnji graf prikazuje delež kadilcev med osebami, starimi vsaj 15 let, ločeno po spolu v letih 2000, 2005, 2010, 2012 in 2015. Presenetilo me je, da je delež kadilcev med moškimi (36.3%) veliko večji kot med ženskami (13.6%). (Slednja procenta sta izračunana kot povprečna deleža med letoma 2000 in 2015.)

```{r tobak, fig.align='center', echo=FALSE, message=FALSE}
g_tb
```

Zemljevid prikazuje število plačanih prostih dni na leto pri 5-dnevnem delovniku. Presenečena sem bila nad ugotovitvijo, da v ZDA zakon ne določa niti enega plačanega prostega dneva na leto. Poleg tega sem pričakovala, da je v Afriki to število precej manjše.

```{r dopust, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE}
g_dop
```


Na naslednjem grafu je prikazano število okuženih z malarijo v letih od 2000 do 2015, dodani so tudi kvartili porazdelitve. Opazen je velik trend naraščanja.

```{r malarija, fig.align='center', echo=FALSE, message=FALSE}
g_mal
```

***

# Napredna analiza podatkov

```{r zemljevida, fig.align='center', echo=FALSE, message=FALSE, warning=FALSE}
n <- 2000
alk <- filter(znacilnosti, leto == n, znacilnost == "alkohol") %>% rename(alkohol = pojavnost)
alk$znacilnost <- NULL
alk$leto <- NULL
den <- filter(znacilnosti, leto == n, znacilnost == "denar") %>% rename(denar = pojavnost)
den$znacilnost <- NULL
den$leto <- NULL
vod <- filter(znacilnosti, leto == n, znacilnost == "voda") %>% rename(voda = pojavnost)
vod$znacilnost <- NULL
vod$leto <- NULL
tub <- filter(bolezni, leto == n, bolezen == "tuberkuloza") %>% 
  rename(tuberkuloza = pojavnost)
tub$bolezen <- NULL
tub$leto <- NULL

zna <- full_join(alk, den) %>% full_join(vod) 
zna <- na.omit(zna)
zna1<- zna
row.names(zna) <- zna$drzava
zna$drzava <- NULL

sk <- scale(zna) %>% kmeans(5, nstart = 1000)
skupine <- data.frame(drzava = zna1$drzava, skupina = factor(sk$cluster))
ggplot() + geom_polygon(data = svet %>% left_join(skupine, by = c("sovereignt" = "drzava")),
                        aes(x = long, y = lat, group = group, fill = skupina)) + 
                          theme_void() + ggtitle("Države po podobnih značilnostih v letu 2000") +      theme(plot.title = element_text(hjust = 0.5)) + guides(fill=guide_legend(title=NULL))

zenske <- filter(tobak, leto == n, spol == "zenske") %>% rename(zenske = pojavnost)
zenske$spol <- NULL
zenske$leto <- NULL
moski <- filter(tobak, leto == n, spol == "moski") %>% rename(moski = pojavnost)
moski$spol <- NULL
moski$leto <- NULL

to <- full_join(zenske, moski)
to <- na.omit(to)
to1 <- to
row.names(to) <- to$drzava
to$drzava <- NULL

sk0 <- scale(to) %>% kmeans(5, nstart = 1000)
skupine0 <- data.frame(drzava = to1$drzava, skupina0 = factor(sk0$cluster))
ggplot() + geom_polygon(data = svet %>% left_join(skupine0, by = c("sovereignt" = "drzava")),
                        aes(x = long, y = lat, group = group, fill = skupina0)) + 
  theme_void() + ggtitle("Države po podobni razširjenosti uporabe tobačnih izdelkov v letu 2000") + 
  theme(plot.title = element_text(hjust = 0.5)) + guides(fill=guide_legend(title=NULL))

ggplot() + geom_polygon(data = svet %>% left_join(tub, by = c("sovereignt" = "drzava")),
                        aes(x = long, y = lat, group = group, fill = tuberkuloza)) + theme_void() + ggtitle("Razširjenost tuberkuloze v letu 2000") + theme(plot.title = element_text(hjust = 0.5)) + guides(fill=guide_legend(title=NULL))
```


***

